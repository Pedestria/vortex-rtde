/*NEUTRON-STAR*/ 
 /*Vortex_RTDE 0.0.3 _MINIFIED_ 
 Alex Topper 
 License: MIT 
 The LiveUpdate Bundler For ALL Purposes. */ 
const fs=require("fs-extra"),terser=require("terser"),path=require("path"),chalk=require("chalk"),cliSpinners=require("cli-spinners"),ora=require("ora"),Babel=require("@babel/parser"),babel_core_NAMESPACE=require("@babel/core"),babel_generator_NAMESPACE=require("@babel/generator"),babel_traverse_NAMESPACE=require("@babel/traverse"),t=require("@babel/types"),resolve=require("resolve");class ImportLocation{constructor(e,n){this.name=e,this.line=n}}class Dependency{constructor(e,n){this.name=e,this.importLocations=[],this.importLocations.push(n)}testForImportLocation(e){for(let n of this.importLocations)if(n.name==e)return!0;return!1}indexOfImportLocation(e){for(let n of this.importLocations)if(n.name==e)return this.importLocations.indexOf(n)}updateName(e){this.name=e}isLibraryDependency(){return!this.name.includes("./")}}class QuarkLibTable{constructor(){this.QuarkLibs=[]}addEntry(e){this.QuarkLibs.push(e)}findEntryByName(e){for(let n of this.QuarkLibs)if(n.name==e)return this.QuarkLibs.indexOf(n);return null}}class QuarkLibEntry{constructor(e,n){this.name=e,this.bundleLocs=n}}var ModuleTypes,DefaultQuarkTable=new QuarkLibTable;DefaultQuarkTable.addEntry(new QuarkLibEntry("aws-sdk",["./node_modules/aws-sdk/dist/aws-sdk.js","./node_modules/aws-sdk/dist/aws-sdk.min.js"]));class FileImportLocation extends ImportLocation{constructor(e,n,t,r){super(e,n),this.relativePathToDep=t,this.localName=r}}class CSSDependency extends Dependency{constructor(e,n,t){super(e,n),this.stylesheet=t}}class Module{constructor(e,n){this.name=e,this.type=n}}!function(e){e[e.EsModule=0]="EsModule",e[e.EsDefaultModule=1]="EsDefaultModule",e[e.EsNamespaceProvider=2]="EsNamespaceProvider",e[e.CjsModule=2]="CjsModule",e[e.CjsDefaultModule=3]="CjsDefaultModule",e[e.CjsDefaultFunction=4]="CjsDefaultFunction",e[e.CjsNamespaceProvider=5]="CjsNamespaceProvider"}(ModuleTypes||(ModuleTypes={}));class MDImportLocation extends ImportLocation{constructor(e,n,t,r){super(e,n),this.modules=t,this.relativePathToDep=r}testForModule(e){for(let n of this.modules)if(n.name==e.name)return!0;return!1}indexOfModuleByName(e){for(let n of this.modules)if(n.name==e)return this.modules.indexOf(n);return null}}var BabelSettings={sourceType:"module",presets:[["@babel/preset-env",{modules:!1}],["@babel/preset-react",{modules:!1}]]};class ModuleDependency extends Dependency{constructor(e,n){super(e,n)}}var CjsModuleGrapher={SearchAndGraph:function(e,n){babel_traverse_NAMESPACE.default(e.ast,{VariableDeclarator:function(t){let r=[];if(null!==t.node.init&&"CallExpression"===t.node.init.type&&"require"===t.node.init.callee.name){if("ObjectPattern"===t.node.id.type)for(let e of t.node.id.properties)r.push(new Module(e.value.name,ModuleTypes.CjsModule));else r.push(new Module(t.node.id.name,ModuleTypes.CjsNamespaceProvider));let o=new MDImportLocation(e.name,t.node.loc.start.line,r,t.node.init.arguments[0].value);Transport(new CjsModuleDependency(t.node.init.arguments[0].value,o),n,e.name,o)}},ExpressionStatement:function(t){let r=[];if("AssignmentExpression"===t.node.expression.type&&"MemberExpression"===t.node.expression.left.type&&"CallExpression"===t.node.expression.right.type&&"require"===t.node.expression.right.callee.name){r.push(new Module(t.node.expression.right.arguments[0].value,ModuleTypes.CjsNamespaceProvider));let o=new MDImportLocation(e.name,t.node.loc.start.line,r,t.node.expression.right.arguments[0].value);Transport(new CjsModuleDependency(t.node.expression.right.arguments[0].value,o),n,e.name,o)}if("CallExpression"===t.node.expression.type){if("Identifier"===t.node.expression.callee.type&&"require"==t.node.expression.callee.name){r.push(new Module("_Default_",ModuleTypes.CjsDefaultModule));let o=new MDImportLocation(e.name,t.node.loc.start.line,r,t.node.expression.arguments[0].value);Transport(new CjsModuleDependency(t.node.expression.arguments[0].value,o),n,e.name,o)}if("CallExpression"===t.node.expression.callee.type&&"require"===t.node.expression.callee.callee.name){r.push(new Module("_DefaultFunction_",ModuleTypes.CjsDefaultFunction));let o=new MDImportLocation(e.name,t.node.loc.start.line,r,t.node.expression.callee.arguments[0].value);Transport(new CjsModuleDependency(t.node.expression.callee.arguments[0].value,o),n,e.name,o)}}}})}};class VortexGraph{constructor(e){this.Star=[],this.entryPoint=e}add(e){this.Star.push(e)}searchFor(e){for(let n of this.Star)if(e.name==n.name&&Object.getPrototypeOf(n)===Object.getPrototypeOf(e))return!0;return!1}update(e){for(let n of this.Star)if(n.name==e.name)for(let t of e.importLocations)0==n.testForImportLocation(t.name)&&n.importLocations.push(t)}remove(e){let n=this.Star.indexOf(e);this.Star.splice(n)}}var EsModuleGrapher={SearchAndGraph:function(e,n){babel_traverse_NAMESPACE.default(e.ast,{ImportDeclaration:function(t){if(isJs(t.node.source.value)){let r=[];for(let e of t.node.specifiers)if("ImportDefaultSpecifier"===e.type){let n;n=new Module(e.local.name,ModuleTypes.EsDefaultModule),r.push(n)}else if("ImportSpecifier"===e.type){let n=new Module(e.local.name,ModuleTypes.EsModule);r.push(n)}else{let n=new Module(e.local.name,ModuleTypes.EsNamespaceProvider);r.push(n)}let o=new MDImportLocation(e.name,t.node.loc.start.line,r,t.node.source.value);Transport(new EsModuleDependency(t.node.source.value,o),n,e.name,o)}else{let r=new FileImportLocation(e.name,t.node.loc.start.line,t.node.source.value,void 0!==t.node.specifiers[0]?t.node.specifiers[0].local.name:null);Transport(resolveDependencyType(t.node.source.value,r,e.name),n,e.name)}}})}};class CjsModuleDependency extends ModuleDependency{constructor(e,n){super(e,n)}verifyImportedModules(e,n){let t=[];babel_traverse_NAMESPACE.default(e.ast,{ExpressionStatement:function(e){"AssignmentExpression"===e.node.expression.type&&"MemberExpression"===e.node.expression.left.type&&("module"===e.node.expression.left.object.name&&"exports"===e.node.expression.left.property.name&&("FunctionExpression"===e.node.expression.right.type||"ArrowFunctionExpression"===e.node.expression.right.type?t.push(new Module("_DefaultFunction_",ModuleTypes.CjsDefaultFunction)):t.push(new Module(e.node.expression.right.name,ModuleTypes.CjsModule))),"exports"===e.node.expression.left.object.name&&("default"===e.node.expression.left.property.name?"UnaryExpression"!==e.node.expression.right.type&&t.push(new Module(e.node.expression.right.name,ModuleTypes.CjsDefaultModule)):"UnaryExpression"!==e.node.expression.right.type&&t.push(new Module(e.node.expression.right.name,ModuleTypes.CjsModule))))}});let r=new MDImportLocation("buffer",0,t,""),o=new Error(chalk.redBright("Non Existant Modules Imported from "+e.name));for(let e of n.modules)if(0==r.testForModule(e)){for(let t of findModulesUnderNamespace(n.name,e.name))if(0==searchForModuleUnderNamespace(n.name,t,e.name))throw o;n.modules[n.indexOfModuleByName(e.name)].type=ModuleTypes.CjsNamespaceProvider}}}class EsModuleDependency extends ModuleDependency{constructor(e,n){super(e,n)}verifyImportedModules(e,n){let t=[];babel_traverse_NAMESPACE.default(e.ast,{ExportDefaultDeclaration:function(e){let n=e.node.declaration.id.name;if(t.push(new Module(n,ModuleTypes.EsDefaultModule)),"ClassDeclaration"===e.node.declaration.type){let n=e.node.declaration.id.name;t.push(new Module(n,ModuleTypes.EsDefaultModule))}if("FunctionDeclaration"===e.node.declaration.type){let n=e.node.declaration.id.name;t.push(new Module(n,ModuleTypes.EsDefaultModule))}},ExportNamedDeclaration:function(e){if("VariableDeclaration"===e.node.declaration.type){let n=e.node.declaration.declarations[0].id.name;t.push(new Module(n,ModuleTypes.EsModule))}else if("ClassDeclaration"===e.node.declaration.type){let n=e.node.declaration.id.name;t.push(new Module(n,ModuleTypes.EsModule))}else if("FunctionDeclaration"===e.node.declaration.type){let n=e.node.declaration.id.name;t.push(new Module(n,ModuleTypes.EsModule))}else{for(let n of e.node.specifiers)if("ExportSpecifier"===n.type){let e=n.exported.name;t.push(new Module(e,ModuleTypes.EsModule))}let n=e.node.declaration.id.name;t.push(new Module(n,ModuleTypes.EsModule))}}});let r=new MDImportLocation("buffer",0,t,""),o=new Error(chalk.redBright("Non Existent Modules Imported from "+e.name));for(let e of n.modules)if(0==r.testForModule(e))for(let t of findModulesUnderNamespace(n.name,e.name))if(0==searchForModuleUnderNamespace(n.name,t,e.name))throw o}}function findModulesUnderNamespace(e,n){const t=fs.readFileSync(e,"utf-8").toString(),r=Babel.parse(t,{sourceType:"module"});let o=[];return babel_traverse_NAMESPACE.default(r,{MemberExpression:function(e){if("Identifier"===e.node.object.type)var t=e.node.object.name;"Identifier"===e.node.property.type&&t==n&&o.push(e.node.property.name)}}),o}function searchForModuleUnderNamespace(e,n,t){const r=fs.readFileSync(e,"utf-8").toString(),o=Babel.parse(r,{sourceType:"module"});let a=!1;return babel_traverse_NAMESPACE.default(o,{MemberExpression:function(e){if("Identifier"===e.node.object.type)var r=e.node.object.name;"Identifier"===e.node.property.type&&r==t&&e.node.property.name===n&&(a=!0)}}),a}function LocalizedResolve(e,n){if(e==n)return e;if("./"==path.dirname(n))return n;let t=path.dirname(e),r=n;return"./"+path.join(t,r)}function resolveLibBundle(e){let n=new RegExp("min");if(["path","fs","module"].includes(e))return"node.js";let t=ResolveLibrary(e);if(t instanceof Array)for(let e of t){if(e.match(n)&&isProduction)return e;if(null==e.match(n)&&0==isProduction)return e}return t}function ResolveLibrary(e){let n=fixLibraryPath(resolve.sync(e)),t=[];if(null!==DefaultQuarkTable.findEntryByName(e))return DefaultQuarkTable.QuarkLibs[DefaultQuarkTable.findEntryByName(e)].bundleLocs;if(0==LibraryRelayVerify(n).length)return n;for(let e of LibraryRelayVerify(n))t.push(LocalizedResolve(n,e));return t}function LibraryRelayVerify(e){const n=fs.readFileSync(e,"utf-8").toString();new RegExp("./");const t=Babel.parse(n,{sourceType:"module"});let r=[];return babel_traverse_NAMESPACE.default(t,{enter(e){"ExpressionStatement"===e.node.type&&"AssignmentExpression"===e.node.expression.type&&"MemberExpression"===e.node.expression.left.type&&"CallExpression"===e.node.expression.right.type&&"module"===e.node.expression.left.object.name&&"exports"===e.node.expression.left.property.name&&"require"===e.node.expression.right.callee.name&&r.push(e.node.expression.right.arguments[0].value)}}),r}function fixLibraryPath(e){if(0==e.includes("node_modules"))throw new Error(chalk.redBright('Package "'+e+'" does not Exist!'));{let n=e.search("node_modules");return"./"+e.slice(n)}}function isQuarky(e){const n=fs.readFileSync(e,"utf-8").toString();new RegExp("./");const t=Babel.parse(n,{sourceType:"module"});return babel_traverse_NAMESPACE.default(t,{enter(n){if("VariableDeclaration"===n.node.type&&null!==n.node.declarations[0].init&&"CallExpression"===n.node.declarations[0].init.type&&"require"===n.node.declarations[0].init.callee.name)if("ObjectPattern"===n.node.declarations[0].id.type){for(let t of n.node.declarations[0].id.properties)if(testForLocalFileRequires(LocalizedResolve(e,t.value)))return!0}else if(testForLocalFileRequires(LocalizedResolve(e,n.node.declarations[0].init.arguments[0].value)))return!0;if("ExpressionStatement"===n.node.type){if("AssignmentExpression"===n.node.expression.type&&"MemberExpression"===n.node.expression.left.type&&"CallExpression"===n.node.expression.right.type&&"require"===n.node.expression.right.callee.name&&testForLocalFileRequires(LocalizedResolve(e,n.node.expression.right.arguments[0].value)))return!0;if("CallExpression"===n.node.expression.type&&"CallExpression"===n.node.expression.callee.type&&"require"===n.node.expression.callee.callee.name&&testForLocalFileRequires(LocalizedResolve(e,n.node.expression.callee.arguments[0].value)))return!0}}}),!1}function testForLocalFileRequires(e){console.log(e);const n=fs.readFileSync(addJsExtensionIfNecessary(e),"utf-8").toString();let t=new RegExp("./");const r=Babel.parse(n,{sourceType:"module"});return babel_traverse_NAMESPACE.default(r,{enter(e){if("VariableDeclaration"===e.node.type){if("CallExpression"===e.node.declarations[0].init.type&&"require"===e.node.declarations[0].init.callee.name)if("ObjectPattern"===e.node.declarations[0].id.type){for(let n of e.node.declarations[0].id.properties)if(null!==n.value.match(t))return!0}else if(null!==e.node.declarations[0].init.arguments[0].value.match(t))return!0}if("ExpressionStatement"===e.node.type){if("AssignmentExpression"===e.node.expression.type&&"MemberExpression"===e.node.expression.left.type&&"CallExpression"===e.node.expression.right.type&&"require"===e.node.expression.right.callee.name&&null!==e.node.expression.right.arguments[0].value.match(t))return!0;if("CallExpression"===e.node.expression.type&&"CallExpression"===e.node.expression.callee.type&&"require"===e.node.expression.callee.callee.name&&null!==e.node.expression.callee.arguments[0].value.match(t))return!0}}}),!1}function addJsExtensionIfNecessary(e){let n=new RegExp(".js");return null!==e.match(n)?e:e+".js"}function getFileExtension(e){let n=e.lastIndexOf(".");return e.slice(n)}function resolveDependencyType(e,n,t){let r;switch(getFileExtension(e)){case".css":r=new CSSDependency(LocalizedResolve(t,e),n,fs.readFileSync(LocalizedResolve(t,e)).toString())}return r}var queue=[];function isInQueue(e){for(let n of queue)if(n.name===e)return!0;return!1}function addEntryToQueue(e){queue.push(e)}function loadEntryFromQueue(e){for(let n of queue)if(n.name===e)return n}class QueueEntry{constructor(e,n){this.name=e,this.ast=n}}async function GenerateGraph(e){let n=new VortexGraph(e),t=[],r=addJsExtensionIfNecessary(e),o=fs.readFileSync(r).toString();isLibrary||(o=babel_core_NAMESPACE.transformSync(fs.readFileSync(r).toString(),BabelSettings).code);let a=Babel.parse(o,{sourceType:"module"});addEntryToQueue(new QueueEntry(e,a)),GraphDepsAndModsForCurrentFile(loadEntryFromQueue(r),n),t.push(e);for(let e of n.Star)if(e instanceof ModuleDependency){let r="./";if(0==t.includes(e.name))if(1==e.name.includes(r)){let r=addJsExtensionIfNecessary(e.name);if(isInQueue(r))GraphDepsAndModsForCurrentFile(loadEntryFromQueue(r),n);else{let e=fs.readFileSync(r).toString();isLibrary||(e=babel_core_NAMESPACE.transformSync(e,BabelSettings).code);let t=Babel.parse(e,{sourceType:"module"}),o=new QueueEntry(r,t);addEntryToQueue(o),GraphDepsAndModsForCurrentFile(loadEntryFromQueue(o.name),n)}t.push(r)}else if(e instanceof ModuleDependency){if(!isLibrary)if(isInQueue(e.libLoc))GraphDepsAndModsForCurrentFile(e.libLoc);else{let t=new QueueEntry(e.libLoc,Babel.parse(fs.readFileSync(e.libLoc).toString(),{sourceType:"module"}));addEntryToQueue(t),GraphDepsAndModsForCurrentFile(loadEntryFromQueue(t.name),n)}t.push(e.name)}}return n}function GraphDepsAndModsForCurrentFile(e,n){EsModuleGrapher.SearchAndGraph(e,n),CjsModuleGrapher.SearchAndGraph(e,n)}function GraphDepsForLib(e,n){e instanceof ModuleDependency&&GraphDepsAndModsForCurrentFile(resolveLibBundle(e.name),n)}function Transport(e,n,t,r){if(e instanceof ModuleDependency)if(e.name.includes("./")){if(e.updateName(LocalizedResolve(t,addJsExtensionIfNecessary(e.name))),e instanceof EsModuleDependency||e instanceof CjsModuleDependency)if(isInQueue(e.name))e.verifyImportedModules(loadEntryFromQueue(e.name),r);else{let n=fs.readFileSync(e.name).toString();isLibrary||(n=babel_core_NAMESPACE.transformSync(n,BabelSettings).code),addEntryToQueue(new QueueEntry(e.name,Babel.parse(n,{sourceType:"module"}))),e.verifyImportedModules(loadEntryFromQueue(e.name),r)}}else e instanceof ModuleDependency&&(e.libLoc=resolveLibBundle(e.name));n.searchFor(e)?n.update(e):n.add(e)}var usingTerser=!1,extensions=Panel.extensions;function isJs(e){let n;return n=!extensions.includes(getFileExtension(e)),n}function createStarPackage(){const e=ora("1. Opening the Portal"),n=ora("2. Vortex Commencing");n.spinner=cliSpinners.bouncingBar;const t=ora("3. Hypercompressing ");t.spinner=cliSpinners.star;let r=Panel.output;if("star"===Panel.bundleMode?isProduction=!1:"neutronstar"===Panel.bundleMode&&(isProduction=!0),1==Panel.useTerser&&!isProduction)throw new Error(chalk.redBright("ERROR: Can not use terser on regular star!"));usingTerser=Panel.useTerser,"app"===Panel.type?isLibrary=!1:"library"===Panel.type&&(isLibrary=!0);let o=fs.readJSONSync("./package.json",{encoding:"utf-8"});e.spinner=cliSpinners.arc,e.start(),GenerateGraph(Panel.start).then(t=>(e.succeed(),n.start(),Compile(t))).then(e=>usingTerser?(n.succeed(),t.start(),terserPackage(r,o,e)):regularPackage(r,o,e)).then(e=>{usingTerser?(t.succeed(),console.log(chalk.bold.yellowBright(`Successfully Created Neutron Star! (${e})`))):(n.succeed(),console.log(chalk.bold.redBright(`Successfully Created Star! (${e})`))),process.exit()})}async function terserPackage(e,n,t){if(isLibrary){let r=`/*NEUTRON-STAR*/ \n /*${n.name} ${n.version} _MINIFIED_ \n ${n.author} \n License: ${n.license} \n ${n.description} */ \n`+terser.minify(t,{compress:!0,mangle:!0}).code,o=path.dirname(e)+"/"+path.basename(e,".js")+".min.js";return fs.ensureDirSync(path.dirname(e)+"/"),fs.writeFileSync(o,r),o}{let n="/*NEUTRON-STAR*/ \n /*BUNDLED BY VORTEX*/ \n"+terser.minify(t,{compress:!0,mangle:!0}).code,r=path.dirname(e)+"/"+path.basename(e,".js")+".min.js";return fs.ensureDirSync(path.dirname(e)+"/"),fs.writeFileSync(r,n),r}}async function regularPackage(e,n,t){if(isLibrary){let r=`/*STAR*/ \n /*${n.name} ${n.version} \n ${n.author} \n License: ${n.license} \n ${n.description} */ \n`;return fs.ensureDirSync(path.dirname(e)+"/"),fs.writeFileSync(e,r+t),e}{let n=(isProduction?"/*NEUTRON-STAR*/ \n /*BUNDLED BY VORTEX*/ \n":"/*STAR*/ \n /*BUNDLED BY VORTEX*/ \n")+t;return fs.ensureDirSync(path.dirname(e)+"/"),fs.writeFileSync(e,n),e}}function fixDependencyName(e){let n="";n="@"===e[0]?e.slice(1):e;for(let e of"\\./@^$#*&!%-")if(n.includes(e))for(;n.includes(e);){let t,r;t=n.slice(0,n.indexOf(e)),r=n.slice(n.indexOf(e)+1),n=`${t}_${r}`}return n}async function Compile(e){let n;return n=isLibrary?LibCompile(e):WebAppCompile(e),n}function LibCompile(e){let n=new LibBundle,t="";for(let t of e.Star)if(t instanceof ModuleDependency){for(let r of t.importLocations)if(r instanceof MDImportLocation)if(n.isInQueue(r.name))0==t.name.includes("./")&&r.modules[0].type!==ModuleTypes.EsNamespaceProvider&&mangleVariableNamesFromAst(n.loadEntryFromQueue(r.name).ast,r.modules),removeImportsFromAST(n.loadEntryFromQueue(r.name).ast,r,t,n);else{let o=fs.readFileSync(r.name).toString();n.addEntryToQueue(new BundleEntry(r.name,Babel.parse(o,{sourceType:"module"}))),0==t.name.includes("./")&&r.modules[0].type!==ModuleTypes.EsNamespaceProvider&&mangleVariableNamesFromAst(n.loadEntryFromQueue(r.name).ast,r.modules),removeImportsFromAST(n.loadEntryFromQueue(r.name).ast,r,t,n),r.name===e.entryPoint&&removeExportsFromAST(n.loadEntryFromQueue(r.name).ast,t,n)}if(n.isInQueue(t.name))t.importLocations[0].modules[0].type===ModuleTypes.EsNamespaceProvider&&convertToNamespace(n.loadEntryFromQueue(t.name).ast,t.importLocations[0]),removeExportsFromAST(n.loadEntryFromQueue(t.name).ast,t,n);else if(t.name.includes("./")){let e=fs.readFileSync(t.name).toString();n.addEntryToQueue(new BundleEntry(t.name,Babel.parse(e,{sourceType:"module"}))),t.importLocations[0].modules[0].type===ModuleTypes.EsNamespaceProvider&&convertToNamespace(n.loadEntryFromQueue(t.name).ast,t.importLocations[0]),removeExportsFromAST(n.loadEntryFromQueue(t.name).ast,t,n)}}let r=n.queue.reverse();t+="/*NODE_REQUIRES*/ \n",t+=n.libs.join("\n"),t+="\n /*LIB_CODE*/ \n";for(let e of r)t+=Division(),t+=babel_generator_NAMESPACE.default(e.ast).code;return t+="\n /*NODE_EXPORTS*/ \n",t+=n.exports.join("\n"),t}function convertToNamespace(e,n){var r=t.variableDeclaration("var",new Array(t.variableDeclarator(t.identifier(n.modules[0].name))));babel_traverse_NAMESPACE.default(e,{ExportNamedDeclaration:function(e){null!==e.node.declaration&&(addToNamespace(e.node.declaration,r),e.remove())},ExportDefaultDeclaration:function(e){null!==e.node.declaration&&(addToNamespace(e.node.declaration,r),e.remove())}}),e.program.body.push(r),e.program.body.reverse()}function addToNamespace(e,n){if(null!==n.declarations[0].init){if("ObjectExpression"===n.declarations[0].init.type)if("FunctionDeclaration"===e.type){let r=e.id;e.id=null,n.declarations[0].init.properties.push(t.objectProperty(r,t.functionExpression(null,e.params,e.body,e.generator,e.async)))}else if("ClassDeclaration"===e.type){let r=e.id;n.declarations[0].init.properties.push(t.objectProperty(r,t.classExpression(null,e.superClass,e.body)))}}else{let r=[];if("FunctionDeclaration"===e.type){let o=e.id;e.id=null,r.push(t.objectProperty(o,t.functionExpression(null,e.params,e.body,e.generator,e.async))),n.declarations[0].init=t.objectExpression(r)}else if("ClassDeclaration"===e.type){let o=e.id;r.push(t.objectProperty(o,t.classExpression(null,e.superClass,e.body))),n.declarations[0].init=t.objectExpression(r)}}}function removeImportsFromAST(e,n,r,o){if(r instanceof CjsModuleDependency)0==r.name.includes("./")&&0==o.isLibEntryInCode(r.name,n.modules[0].name)&&o.addEntryToLibs(r.name,n.modules[0].name),n.modules[0].type===ModuleTypes.CjsNamespaceProvider&&babel_traverse_NAMESPACE.default(e,{VariableDeclaration:function(e){null!==e.node.declarations[0].init&&"CallExpression"===e.node.declarations[0].init.type&&"require"===e.node.declarations[0].init.callee.name&&e.node.declarations[0].id.name===n.modules[0].name&&e.node.declarations[0].init.arguments[0].value===n.relativePathToDep&&e.remove()},MemberExpression:function(e){r.name.includes("./")&&e.node.object.name==n.modules[0].name&&null!==e.node.property&&("default"===e.node.property.name?e.replaceWith(t.identifier(findDefaultExportName(r))):e.replaceWith(t.identifier(e.node.property.name)))}});else if(r instanceof EsModuleDependency){if(0==r.name.includes("./"))if(n.modules[0].type===ModuleTypes.EsNamespaceProvider)0==o.isLibEntryInCode(r.name,n.modules[0].name)&&o.addEntryToLibs(r.name,n.modules[0].name);else{var a=fixDependencyName(r.name)+"_NAMESPACE";0==o.isLibEntryInCode(r.name,a)&&o.addEntryToLibs(r.name,a)}babel_traverse_NAMESPACE.default(e,{ImportDeclaration:function(e){e.node.source.value===n.relativePathToDep&&e.remove()},Identifier:function(e){if(0==r.name.includes("./")&&n.modules[0].type!==ModuleTypes.EsNamespaceProvider)for(let r of n.modules)r.type!==ModuleTypes.EsDefaultModule?e.node.name==="_"+r.name&&e.replaceWith(t.memberExpression(t.identifier(a),t.identifier(r.name))):r.type===ModuleTypes.EsDefaultModule&&e.node.name==="_"+r.name&&e.replaceWith(t.memberExpression(t.identifier(a),t.identifier("default")))}})}}function findDefaultExportName(e){let n,t=fs.readFileSync(e.name).toString(),r=Babel.parse(t,{sourceType:"module"});return e instanceof CjsModuleDependency?babel_traverse_NAMESPACE.default(r,{ExpressionStatement:function(e){"AssignmentExpression"===e.node.expression.type&&"MemberExpression"===e.node.expression.left.type&&null!==e.node.expression.left&&"exports"===e.node.expression.left.object.name&&"default"===e.node.expression.left.property.name&&(n=e.node.expression.right.name)}}):e instanceof EsModuleDependency&&babel_traverse_NAMESPACE.default(r,{ExportDefaultDeclaration:function(e){null!==e.node.declaration&&(n=e.node.declaration.id.name)},ExportNamedDeclaration:function(e){if(null==e.node.declaration)for(let t of e.node.specifiers)"ExportSpecifier"===t.type&&"default"===t.exported.name&&(n=t.local.name)}}),n}function removeExportsFromAST(e,n,t){n instanceof CjsModuleDependency?babel_traverse_NAMESPACE.default(e,{ExpressionStatement:function(e){"AssignmentExpression"===e.node.expression.type&&"MemberExpression"===e.node.expression.left.type&&("module"===e.node.expression.left.object.name&&"exports"===e.node.expression.left.property.name&&e.remove(),"exports"===e.node.expression.left.object.name&&e.remove())}}):n instanceof EsModuleDependency&&babel_traverse_NAMESPACE.default(e,{ExportNamedDeclaration:function(e){if(null!==e.node.declaration)"Identifier"!==e.node.declaration.type||0===e.node.specifiers.length?e.replaceWith(e.node.declaration):e.remove();else if(findVortexExpose(e.node)){for(let n of getExposures(e.node))t.addEntryToExposedExports(n);e.remove()}else e.remove()},ExportDefaultDeclaration:function(e){"Identifier"!==e.node.declaration.type?e.replaceWith(e.node.declaration):e.remove()}})}function Division(){return"\n /*VORTEX_DIVIDER*/ \n"}createStarPackage();class LibBundle{constructor(){this.queue=[],this.libs=[],this.exports=[]}addEntryToQueue(e){this.queue.push(e)}addEntryToLibs(e,n){const r=CommonJSTemplate({NAMESPACE:t.identifier(n),LIBNAME:t.stringLiteral(e)}),o=babel_generator_NAMESPACE.default(r);this.libs.push(o.code)}addEntryToExposedExports(e){const n=CJSExportsTemplate({EXPORT:t.identifier(e)}),r=babel_generator_NAMESPACE.default(n);this.exports.push(r.code)}isExportEntryInCode(e){for(let n of this.exports)if(n.includes(e))return!0;return!1}isLibEntryInCode(e,n){for(let t of this.libs)if(t.includes(e)&&t.includes(n))return!0;return!1}isInQueue(e){for(let n of this.queue)if(n.name==e)return!0;return!1}loadEntryFromQueue(e){for(let n of this.queue)if(n.name==e)return n}}const CommonJSTemplate=babel_core_NAMESPACE.template("const NAMESPACE = require(LIBNAME)"),CJSExportsTemplate=babel_core_NAMESPACE.template("exports.EXPORT = EXPORT");class BundleEntry{constructor(e,n){this.name=e,this.ast=n}}function mangleVariableNamesFromAst(e,n){babel_traverse_NAMESPACE.default(e,{Identifier:function(e){for(let t of n)t.name===e.node.name&&(e.node.name="_"+e.node.name)}})}function findVortexExpose(e){if(void 0!==e.trailingComments){let n=e.trailingComments.map(e=>e.value);for(let e of n)if("vortexExpose"===e)return!0}else for(let n of e.specifiers)if(void 0!==n.trailingComments&&"vortexExpose"===n.trailingComments[0].value)return!0;return!1}function getExposures(e){let n=e.specifiers.map(e=>e.exported.name);if(void 0!==e.trailingComments){let t=e.trailingComments.map(e=>e.value);for(let e of t)if("vortexExpose"===e)return n}let t=[];for(let n of e.specifiers)"vortexExpose"===n.trailingComments[0].value&&t.push(n.exported.name);return t}const ModuleEvalTemplate=babel_core_NAMESPACE.template("eval(CODE)");function WebAppCompile(e){let n=new Shuttle;for(let n of e.Star)if(n instanceof ModuleDependency){for(let e of n.importLocations)TransformImportsFromAST(loadEntryFromQueue(e.name).ast,e,n);TransformExportsFromAST(loadEntryFromQueue(n.name.includes("./")?n.name:n.libLoc).ast,n)}else if(n instanceof CSSDependency)for(let e of n.importLocations)injectCSSDependencyIntoAST(loadEntryFromQueue(e.name).ast,n,e);let r=[];const o=loadEntryFromQueue(e.entryPoint);stripNodeProcess(o.ast);const a=babel_generator_NAMESPACE.default(o.ast,{sourceMaps:!1}),s=isProduction?o.ast.program.body:ModuleEvalTemplate({CODE:t.stringLiteral(a.code+`\n //# sourceURL=${o.name} \n`)});n.addModuleToBuffer(e.entryPoint,s),r.push(e.entryPoint);for(let o of e.Star)if(o instanceof ModuleDependency)if(void 0!==o.libLoc){if(0==r.includes(o.libLoc)){const e=loadEntryFromQueue(o.libLoc);stripNodeProcess(e.ast);const a=babel_generator_NAMESPACE.default(e.ast,{sourceMaps:!1}),s=isProduction?e.ast.program.body:ModuleEvalTemplate({CODE:t.stringLiteral(a.code+`\n //# sourceURL=${e.name} \n`)});n.addModuleToBuffer(o.libLoc,s),r.push(o.libLoc)}}else if(0==r.includes(o.name)){const e=loadEntryFromQueue(o.name);stripNodeProcess(e.ast);const a=babel_generator_NAMESPACE.default(e.ast,{sourceMaps:!1}),s=isProduction?e.ast.program.body:ModuleEvalTemplate({CODE:t.stringLiteral(a.code+`\n //#sourceURL:${e.name} \n`)});n.addModuleToBuffer(o.name,s),r.push(o.name)}let i=`\n    //Named Exports For Module\n    var loadedModules = [];\n    var loadedStyles = [];\n    var loadedExportsByModule = {}; \n    //Shuttle Module Loader\n    //Finds exports and returns them under fake namespace.\n  \n    function shuttle(mod_name) {\n      //If module has already been loaded, load the exports that were cached away.\n      if (loadedModules.includes(mod_name)) {\n        return loadedExportsByModule[mod_name].cachedExports;\n      } else {\n        var mod = {\n          exports: {}\n        };\n        modules[mod_name](shuttle, mod.exports,loadedStyles);\n  \n        var o = new Object(mod_name);\n        Object.defineProperty(o, 'cachedExports', {\n          value: mod.exports,\n          writable: false\n        });\n        Object.defineProperty(loadedExportsByModule, mod_name, {\n          value: o\n        });\n        loadedModules.push(mod_name);\n        return mod.exports;\n      }\n    } \n    //Calls EntryPoint to Initialize\n  \n  \n    return shuttle('${e.entryPoint}');`,l=Babel.parse(i,{allowReturnOutsideFunction:!0}).program.body;return babel_generator_NAMESPACE.default(t.expressionStatement(t.callExpression(t.identifier(""),[t.callExpression(t.functionExpression(null,[t.identifier("modules")],t.blockStatement(l),!1,!1),[n.buffer])])),{compact:!!isProduction}).code}class Shuttle{constructor(){this.buffer=t.objectExpression([])}addModuleToBuffer(e,n){let r=t.functionExpression(null,[t.identifier("shuttle"),t.identifier("shuttle_exports"),t.identifier("gLOBAL_STYLES")],t.blockStatement(isProduction?n:[n]),!1,!1);this.buffer.properties.push(t.objectProperty(t.stringLiteral(e),t.callExpression(t.identifier(""),[r])))}isInBuffer(e){for(let n of this.buffer.properties)if("ObjectProperty"===n.type&&n.key===t.stringLiteral(e))return!0;return!1}}const ShuttleInitialize=babel_core_NAMESPACE.template("MODULE = shuttle(MODULENAME)"),ShuttleExportNamed=babel_core_NAMESPACE.template("shuttle_exports.EXPORT = LOCAL"),ShuttleExportDefault=babel_core_NAMESPACE.template("shuttle_exports.default = EXPORT");function TransformImportsFromAST(e,n,r){let o="VORTEX_MODULE_"+fixDependencyName(r.name);r instanceof EsModuleDependency?babel_traverse_NAMESPACE.default(e,{ImportDeclaration:function(e){e.node.source.value===n.relativePathToDep&&(r.name.includes("./")?e.replaceWith(t.variableDeclaration("var",[t.variableDeclarator(t.identifier(o),t.callExpression(t.identifier("shuttle"),[t.stringLiteral(r.name)]))])):e.replaceWith(t.variableDeclaration("var",[t.variableDeclarator(t.identifier(o),t.callExpression(t.identifier("shuttle"),[t.stringLiteral(r.libLoc)]))])))},Identifier:function(e){"MemberExpression"!==e.parent.type&&"ImportSpecifier"!==e.parent.type&&"ImportDefaultSpecifier"!==e.parent.type&&null!==n.indexOfModuleByName(e.node.name)&&(0==r.name.includes("./")?n.modules[n.indexOfModuleByName(e.node.name)].type!==ModuleTypes.EsDefaultModule&&e.replaceWith(t.memberExpression(t.identifier(o),t.identifier(e.node.name))):n.modules[n.indexOfModuleByName(e.node.name)].type===ModuleTypes.EsDefaultModule?e.replaceWith(t.memberExpression(t.identifier(o),t.identifier("default"))):e.replaceWith(t.memberExpression(t.identifier(o),t.identifier(e.node.name))))},MemberExpression:function(e){if(0==r.name.includes("./")&&"Identifier"===e.node.object.type&&void 0!==n.modules[n.indexOfModuleByName(e.node.object.name)]){let r=n.modules[n.indexOfModuleByName(e.node.object.name)];r.type===ModuleTypes.EsDefaultModule&&r.name===e.node.object.name&&e.replaceWith(t.memberExpression(t.identifier(o),e.node.property))}}}):r instanceof CjsModuleDependency&&n.modules[0].type===ModuleTypes.CjsNamespaceProvider&&babel_traverse_NAMESPACE.default(e,{VariableDeclaration:function(e){for(let t of e.node.declarations)null!==t.init&&"CallExpression"===t.init.type&&"require"===t.init.callee.name&&t.init.arguments[0].value===n.relativePathToDep&&(t.id.name=o,t.init.callee.name="shuttle",t.init.arguments[0].value=r.name.includes("./")?r.name:r.libLoc)},MemberExpression:function(e){"ObjectProperty"===e.parent.type?e.node.name!==e.parent.key&&e.node===e.parent.value&&e.node.object.name===n.modules[0].name&&null!==e.node.property&&e.replaceWith(t.memberExpression(t.identifier(o),e.node.property)):"Identifier"===e.node.object.type&&e.node.object.name===n.modules[0].name&&null!==e.node.property&&e.replaceWith(t.memberExpression(t.identifier(o),e.node.property))},Identifier:function(e){"ObjectProperty"===e.parent.type?e.node.name!==e.parent.key&&e.node===e.parent.value&&e.node.name===n.modules[0].name&&e.replaceWith(t.memberExpression(t.identifier(o),t.identifier("default"))):"MemberExpression"!==e.parent.type&&"VariableDeclarator"!==e.parent.type&&"FunctionDeclaration"!==e.parent.type&&e.node.name===n.modules[0].name&&("CallExpression"===e.parent.type&&e.node.name===e.parent.callee.name?e.replaceWith(t.memberExpression(t.identifier(o),t.identifier("default"))):e.node.name=o)}})}function TransformExportsFromAST(e,n){if(n instanceof EsModuleDependency&&null==n.libLoc){let n,t=[];babel_traverse_NAMESPACE.default(e,{ExportNamedDeclaration:function(e){if(void 0!==e.node.declaration)"FunctionDeclaration"===e.node.declaration.type?t.push(e.node.declaration.id.name):"VariableDeclaration"===e.node.declaration.type&&t.push(e.node.declaration.declarations[0].id.name),e.replaceWith(e.node.declaration);else{for(let n of e.node.specifiers)t.push(n.exported.name);e.remove()}},ExportDefaultDeclaration:function(e){"FunctionDeclaration"===e.node.declaration.type?n=e.node.declaration.id.name:"Identifier"===e.node.declaration.type&&(n=e.node.declaration.name),e.replaceWith(e.node.declaration)}});for(let n of t)e.program.body.push(ShuttleExportNamed({EXPORT:n,LOCAL:n}));void 0!==n&&e.program.body.push(ShuttleExportDefault({EXPORT:n}))}else(n instanceof CjsModuleDependency||null!==n.libLoc)&&babel_traverse_NAMESPACE.default(e,{AssignmentExpression:function(e){"MemberExpression"===e.node.left.type&&"Identifier"===e.node.left.object.type&&("exports"===e.node.left.object.name?e.replaceWith(ShuttleExportNamed({EXPORT:e.node.left.property.name,LOCAL:e.node.right})):"module"===e.node.left.object.name&&"exports"===e.node.left.property.name&&e.replaceWith(ShuttleExportDefault({EXPORT:"Identifier"===e.node.right.type?e.node.right.name:e.node.right})))},MemberExpression:function(e){"AssignmentExpression"!==e.parent.type&&"Identifier"===e.node.object.type&&"exports"===e.node.object.name&&(e.node.object.name="shuttle_exports")}})}function stripNodeProcess(e){babel_traverse_NAMESPACE.default(e,{IfStatement:function(e){"BinaryExpression"===e.node.test.type&&"MemberExpression"===e.node.test.left.type&&"MemberExpression"===e.node.test.left.object.type&&"process"===e.node.test.left.object.object.name&&e.replaceWithMultiple(e.node.consequent.body)}})}const CSSInjector=babel_core_NAMESPACE.template("if(!gLOBAL_STYLES.includes(DEPNAME)){var style = document.createElement('style'); style.innerHTML=CSS;document.head.appendChild(style);gLOBAL_STYLES.push(DEPNAME)}");function injectCSSDependencyIntoAST(e,n,r){babel_traverse_NAMESPACE.default(e,{ImportDeclaration:function(e){e.node.source.value===r.relativePathToDep&&e.replaceWith(CSSInjector({DEPNAME:t.stringLiteral(n.name),CSS:t.stringLiteral(n.stylesheet)}))}})}var isProduction,isLibrary,useDebug;usingTerser=!1,extensions=Panel.extensions;function isJs(e){let n;return n=!extensions.includes(getFileExtension(e)),n}function createStarPackage(){const e=ora("1. Opening the Portal"),n=ora("2. Vortex Commencing");n.spinner=cliSpinners.bouncingBar;const t=ora("3. Hypercompressing ");t.spinner=cliSpinners.star;let r=Panel.output;if("star"===Panel.bundleMode?isProduction=!1:"neutronstar"===Panel.bundleMode&&(isProduction=!0),1==Panel.useTerser&&!isProduction)throw new Error(chalk.redBright("ERROR: Can not use terser on regular star!"));usingTerser=Panel.useTerser,"app"===Panel.type?isLibrary=!1:"library"===Panel.type&&(isLibrary=!0);let o=fs.readJSONSync("./package.json",{encoding:"utf-8"});e.spinner=cliSpinners.arc,e.start(),GenerateGraph(Panel.start).then(t=>(e.succeed(),n.start(),Compile(t))).then(e=>usingTerser?(n.succeed(),t.start(),terserPackage(r,o,e)):regularPackage(r,o,e)).then(e=>{usingTerser?(t.succeed(),console.log(chalk.bold.yellowBright(`Successfully Created Neutron Star! (${e})`))):(n.succeed(),console.log(chalk.bold.redBright(`Successfully Created Star! (${e})`))),process.exit()})}async function terserPackage(e,n,t){if(isLibrary){let r=`/*NEUTRON-STAR*/ \n /*${n.name} ${n.version} _MINIFIED_ \n ${n.author} \n License: ${n.license} \n ${n.description} */ \n`+terser.minify(t,{compress:!0,mangle:!0}).code,o=path.dirname(e)+"/"+path.basename(e,".js")+".min.js";return fs.ensureDirSync(path.dirname(e)+"/"),fs.writeFileSync(o,r),o}{let n="/*NEUTRON-STAR*/ \n /*BUNDLED BY VORTEX*/ \n"+terser.minify(t,{compress:!0,mangle:!0}).code,r=path.dirname(e)+"/"+path.basename(e,".js")+".min.js";return fs.ensureDirSync(path.dirname(e)+"/"),fs.writeFileSync(r,n),r}}async function regularPackage(e,n,t){if(isLibrary){let r=`/*STAR*/ \n /*${n.name} ${n.version} \n ${n.author} \n License: ${n.license} \n ${n.description} */ \n`;return fs.ensureDirSync(path.dirname(e)+"/"),fs.writeFileSync(e,r+t),e}{let n=(isProduction?"/*NEUTRON-STAR*/ \n /*BUNDLED BY VORTEX*/ \n":"/*STAR*/ \n /*BUNDLED BY VORTEX*/ \n")+t;return fs.ensureDirSync(path.dirname(e)+"/"),fs.writeFileSync(e,n),e}}createStarPackage();